"use strict";(self.webpackChunkportal=self.webpackChunkportal||[]).push([[226],{91180:function(fe,O,s){s.r(O),s.d(O,{default:function(){return le}});var $=s(13448),R=s.n($),W=s(74815),J=s.n(W),U=s(28152),D=s.n(U),G=s(36803),H=s(26245),M=s(60822),X=s(81820),u=s(64619),Q=s(25624),A=s(93236),l=s(94013),y=s(9034),N=s(92790),K=s(26768),k=s(96762),w=s(37632),q=s(77117),V=s.n(q),z=s(24105),S=s(67040),_=s(65439),ee=s(37487),te=s(12146),L=s(26230),n=s(62086),ae={labelCol:{span:6},wrapperCol:{span:18}},Y=z.default.Option,se="AWvWpDl0co2xr9H9_Jq_2Ta5zrHw8BQVhtPJ2Aj6YGh7-BvWQ1uqXruJ3j0yUEPmmagdKO8OIBXYIbjv",ne="P-5U795637TX077043WM2JZM4I",ie="P-7C444005KB6806037M2LSOEI",re=function(m){var c=m.open,e=m.confirmLoading,g=m.onOK,I=m.onCancel,b=m.onError,x=(0,M.useModel)("@@initialState"),d=x.initialState,v=(0,M.useIntl)(),T=S.Z.useForm(),P=D()(T,1),p=P[0];(0,A.useEffect)(function(){E()});var E=function(){p.setFieldsValue({type:l.SubscriptionType.Monthly,amount:50})},B=function(f){var r=p.getFieldValue("type"),j=p.getFieldValue("amount"),h={subscriptionType:r,amount:j,payChannel:"paypal",state:l.SubscriptionState.Paid,referenceId:f};y.B.createSubscription(h,{withCredentials:!0,headers:{Authorization:"Bearer "+(d==null?void 0:d.accessToken)}}).then(function(C){g(h)}).catch(function(C){var pe=C;b(pe)})},F=function(f,r){var j=p.getFieldValue("type"),h=ne;j==l.SubscriptionType.Yearly&&(h=ie);var C=p.getFieldValue("amount");return r.subscription.create({plan_id:h,quantity:C})},Z=function(f,r){return p.validateFields().then(function(j){return B(f.subscriptionID)})},o=function(f,r){I()},a=function(f){b(f)},t={clientId:se,currency:"USD",vault:!0,intent:"subscription"};return(0,n.jsxs)(_.Z,{title:v.formatMessage({id:"components.subscriptionModal.title.new",defaultMessage:"\u8BA2\u9605"}),maskClosable:!1,open:c,confirmLoading:e,onCancel:I,destroyOnClose:!0,width:600,footer:[],children:[(0,n.jsxs)(S.Z,V()(V()({},ae),{},{form:p,name:"control-ref",initialValues:{type:l.SubscriptionType.Monthly,amount:10},children:[(0,n.jsx)(S.Z.Item,{name:"type",label:v.formatMessage({id:"model.subscription.type"}),rules:[{required:!0}],children:(0,n.jsxs)(z.default,{children:[(0,n.jsx)(Y,{value:l.SubscriptionType.Monthly,children:v.formatMessage({id:"model.subscription.type.monthly"})}),(0,n.jsx)(Y,{value:l.SubscriptionType.Yearly,children:v.formatMessage({id:"model.subscription.type.yearly"})})]})}),(0,n.jsx)(S.Z.Item,{name:"amount",label:v.formatMessage({id:"model.subscription.amount"}),rules:[{required:!0}],children:(0,n.jsx)(ee.Z,{min:10,max:1e4})})]})),(0,n.jsx)(te.Z,{}),(0,n.jsx)(L.Vv,{options:t,children:(0,n.jsx)(L.ch,{createSubscription:F,onApprove:Z,onError:a,onCancel:o,style:{shape:"rect",color:"blue",layout:"vertical",label:"subscribe"}})})]})},oe=re,ce=s(87254),ue=function(){var m=(0,M.useModel)("@@initialState"),c=m.initialState,e=(0,M.useIntl)(),g=(0,A.useRef)(),I=(0,A.useState)(!1),b=D()(I,2),x=b[0],d=b[1],v=function(){var o=J()(R()().mark(function a(){var t,i;return R()().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,console.log(c==null?void 0:c.accessToken),r.next=4,y.B.listSubscriptions({withCredentials:!0,headers:{Authorization:"Bearer "+(c==null?void 0:c.accessToken)}});case 4:if(t=r.sent,t.status!=200){r.next=13;break}if(!(t.data.length>0)){r.next=10;break}return r.abrupt("return",{data:t.data});case 10:return r.abrupt("return",{data:[]});case 11:r.next=14;break;case 13:(0,u.Ii)("error",e.formatMessage({id:"components.notification.title.error",defaultMessage:"\u9519\u8BEF"}),e.formatMessage({id:"api.subscriptionsApi.getSubscriptions.failed",defaultMessage:"\u83B7\u53D6\u7528\u6237\u8BA2\u9605\u6570\u636E\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\uFF0C\u91CD\u65B0\u5C1D\u8BD5\u3002\u72B6\u6001\u7801\uFF1A{code}({text})"},{code:t.status,text:t.statusText}));case 14:r.next=20;break;case 16:r.prev=16,r.t0=r.catch(0),i=r.t0,(0,u.hA)(e.formatMessage({id:"components.notification.title.error",defaultMessage:"\u9519\u8BEF"}),e.formatMessage({id:"api.subscriptionsApi.getSubscriptions.failed",defaultMessage:"\u83B7\u53D6\u7528\u6237\u8BA2\u9605\u6570\u636E\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\uFF0C\u91CD\u65B0\u5C1D\u8BD5\u3002\u72B6\u6001\u7801\uFF1A{code}({text})"},{code:i.code,text:i.message}),i,e);case 20:return r.abrupt("return",{data:[]});case 21:case"end":return r.stop()}},a,null,[[0,16]])}));return function(){return o.apply(this,arguments)}}(),T=function(a){y.B.cancelSubscription(a.id,{withCredentials:!0,headers:{Authorization:"Bearer "+(c==null?void 0:c.accessToken)}}).then(function(t){var i;(0,u.sM)(e.formatMessage({id:"components.notification.title.success"}),e.formatMessage({id:"api.subscription.createSubscription.success",defaultMessage:"\u53D6\u6D88\u8BA2\u9605\u6210\u529F\uFF0C\u8BA2\u9605ID\u662F\uFF1A{subscriptionId}\u3002"},{subscriptionId:a.referenceId})),(i=g.current)===null||i===void 0||i.reload()}).catch(function(t){var i=t;(0,u.hA)(e.formatMessage({id:"components.notification.title.error",defaultMessage:"\u9519\u8BEF"}),e.formatMessage({id:"api.subscriptionsApi.cancelSubscription.failed",defaultMessage:"\u53D6\u6D88\u8BA2\u9605\u5931\u8D25\uFF0C\u8BA2\u9605ID\u662F\uFF1A{subscriptionId}\u3002"},{subscriptionId:a.referenceId}),i,e)})},P=function(a){y.B.deleteSubscription(a.id,{withCredentials:!0,headers:{Authorization:"Bearer "+(c==null?void 0:c.accessToken)}}).then(function(t){var i;(0,u.sM)(e.formatMessage({id:"components.notification.title.success"}),e.formatMessage({id:"api.subscription.deleteSubscription.success",defaultMessage:"\u5220\u9664\u8BA2\u9605\u6210\u529F\uFF0C\u8BA2\u9605ID\u662F\uFF1A{subscriptionId}\u3002"},{subscriptionId:a.referenceId})),(i=g.current)===null||i===void 0||i.reload()}).catch(function(t){var i=t;(0,u.hA)(e.formatMessage({id:"components.notification.title.error",defaultMessage:"\u9519\u8BEF"}),e.formatMessage({id:"api.subscriptionsApi.deleteSubscription.failed",defaultMessage:"\u9664\u8BA2\u9605\u5931\u8D25\uFF0C\u8BA2\u9605ID\u662F\uFF1A{subscriptionId}\u3002"},{subscriptionId:a.referenceId}),i,e)})},p=function(){d(!0)},E=function(a){var t;(0,u.sM)(e.formatMessage({id:"components.notification.title.success"}),e.formatMessage({id:"api.subscription.createSubscription.success",defaultMessage:"\u521B\u5EFA\u8BA2\u9605\u6210\u529F\uFF0C\u8BA2\u9605ID\u662F{subscriptionId}\u3002"},{subscriptionId:a.referenceId})),d(!1),(t=g.current)===null||t===void 0||t.reload()},B=function(){(0,u.o7)(e.formatMessage({id:"components.notification.title.info"}),e.formatMessage({id:"api.subscription.createSubscription.cancel",defaultMessage:"\u60A8\u5DF2\u53D6\u6D88\u8BA2\u9605\u3002"})),d(!1)},F=function(a){if(X.default.isAxiosError(a)){(0,u.hA)(e.formatMessage({id:"components.notification.title.error",defaultMessage:"\u9519\u8BEF"}),e.formatMessage({id:"api.subscription.createSubscription.failed",defaultMessage:"\u521B\u5EFA\u8BA2\u9605\u5931\u8D25\uFF0C\u8BF7\u8054\u7CFB\u6211\u4EEC\u3002"},{code:a.code}),a,e),d(!1);return}(0,u.bV)(e.formatMessage({id:"components.notification.title.error",defaultMessage:"\u9519\u8BEF"}),e.formatMessage({id:"api.subscription.createSubscription.error",defaultMessage:"\u975E\u5E38\u62B1\u6B49\uFF0C\u8BA2\u9605\u8FC7\u7A0B\u4E2D\u51FA\u73B0\u9519\u8BEF\uFF0C\u8BF7\u60A8\u91CD\u65B0\u5C1D\u8BD5\u3002"}),a,e),d(!1)},Z=[{title:e.formatMessage({id:"model.subscription.subscriptionId",defaultMessage:"\u8BA2\u9605ID"}),dataIndex:"subscriptionId",key:"subscriptionId",search:!1,render:function(a,t){return[(0,n.jsx)("div",{children:t.referenceId},"subscriptionId")]}},{title:e.formatMessage({id:"model.subscription.type",defaultMessage:"\u8BA2\u9605\u7C7B\u578B"}),dataIndex:"type",key:"type",search:!1,render:function(a,t){return[(0,n.jsx)("div",{children:e.formatMessage({id:"model.subscription.type."+t.subscriptionType})},"type")]}},{title:e.formatMessage({id:"model.subscription.amount",defaultMessage:"\u8282\u70B9\u6570\u91CF"}),dataIndex:"amount",key:"amount",sorter:function(a,t){return a.amount>t.amount?1:a.amount==t.amount?0:-1},search:!1,render:function(a,t){return[(0,n.jsx)("div",{children:t.amount},"amount")]}},{title:e.formatMessage({id:"model.subscription.state",defaultMessage:"\u8BA2\u9605\u72B6\u6001"}),dataIndex:"state",key:"state",search:!1,render:function(a,t){return[(0,n.jsx)("div",{children:e.formatMessage({id:"model.subscription.state."+t.state})},"state")]}},{title:e.formatMessage({id:"model.subscription.payChannel",defaultMessage:"\u4ED8\u6B3E\u6E20\u9053"}),dataIndex:"payChannel",key:"payChannel",search:!1,render:function(a,t){return[(0,n.jsx)("div",{children:t.payChannel!=""&&e.formatMessage({id:"model.subscription.payChannel."+t.payChannel})},"payChannel")]}},{title:e.formatMessage({id:"model.subscription.createAt",defaultMessage:"\u521B\u5EFA\u65F6\u95F4"}),dataIndex:"createAt",key:"createAt",search:!1,render:function(a,t){return[(0,n.jsx)("div",{children:(0,Q.p6)(t.createdAt)},"createAt")]}},{title:e.formatMessage({id:"title.action",defaultMessage:"\u64CD\u4F5C"}),width:"80px",key:"action",search:!1,render:function(a,t){return[(0,n.jsxs)(N.Z,{size:"middle",children:[t.state==l.SubscriptionState.Paid&&(0,n.jsx)(K.Z,{title:(0,n.jsxs)("div",{children:[e.formatMessage({id:"pages.subscription.action.cancelSubscription.confirmmessage",defaultMessage:"\u8BF7\u786E\u8BA4\u53D6\u6D88\u8BA2\u9605 {subscriptionId}?"},{subscriptionId:t.referenceId}),(0,n.jsx)("p",{}),(0,n.jsxs)(ce.Z,{children:[" ",e.formatMessage({id:"pages.subscription.action.cancelSubscription.impact"})," "]})]}),onConfirm:function(){return T(t)},placement:"topRight",children:(0,n.jsx)("a",{children:e.formatMessage({id:"pages.subscription.action.cancelSubscription",defaultMessage:"\u53D6\u6D88\u8BA2\u9605"})})}),(t.state==l.SubscriptionState.Unpaid||t.state==l.SubscriptionState.Cancelled)&&(0,n.jsx)(K.Z,{title:(0,n.jsx)("div",{children:e.formatMessage({id:"pages.subscription.action.deleteSubscription.confirmmessage",defaultMessage:"\u8BF7\u786E\u8BA4\u5220\u9664\u8BA2\u9605 {subscriptionId}?"},{subscriptionId:t.referenceId})}),onConfirm:function(){return P(t)},placement:"topRight",children:(0,n.jsx)("a",{children:e.formatMessage({id:"pages.subscription.action.deleteSubscription",defaultMessage:"\u5220\u9664"})})})]},"actions")]}}];return(0,n.jsxs)(G._z,{children:[(0,n.jsx)(H.Z,{columns:Z,actionRef:g,cardBordered:!0,request:v,rowKey:function(a){return a.id},columnsState:{persistenceKey:"wiseinf-portal-subscription",persistenceType:"localStorage",onChange:function(a){}},search:!1,options:{setting:{listsHeight:600}},pagination:{pageSize:10},dateFormatter:"string",toolBarRender:function(){return[(0,n.jsx)(k.ZP,{icon:(0,n.jsx)(w.Z,{}),onClick:p,type:"primary",children:e.formatMessage({id:"btn.new"})},"button")]}}),x&&(0,n.jsx)(oe,{open:x,confirmLoading:!1,onOK:E,onCancel:B,onError:F})]})},le=ue}}]);
